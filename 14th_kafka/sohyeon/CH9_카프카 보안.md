# 9μ¥ μΉ΄ν”„μΉ΄ λ³΄μ•
- μΉ΄ν”„μΉ΄ μ• ν”λ¦¬μΌ€μ΄μ…μ—μ„ μ κ³µν•λ” λ³΄μ• μ”μ†
- λ³΄μ• κΈ°λ¥ μ§μ ‘ κµ¬μ„±

<br/>

## 9.1 μΉ΄ν”„μΉ΄ λ³΄μ•μ 3κ°€μ§€ μ”μ†

<img alt="image" width="500" src="https://github.com/mash-up-kr/S3A/assets/55437339/6668d4ee-1d8a-4abf-9594-03f7692857a4"/>

π”Ό μΉ΄ν”„μΉ΄ λ³΄μ•μ 3μ”μ†
- **μ•”νΈν™”**: μ¤‘κ°„μ—μ„ ν¨ν‚·μ„ κ°€λ΅μ±„λ”λΌλ„ μ•”νΈν™”λ¥Ό μ„¤μ •ν•΄λ‘μ–΄ λ°μ΄ν„°λ¥Ό μ½μ„ μ μ—†κ² ν•λ‹¤.
- **μΈμ¦**: μΉ΄ν”„μΉ΄ ν΄λΌμ΄μ–ΈνΈλ“¤μ΄ μ ‘κ·Όν•  λ• ν™•μΈλ ν΄λΌμ΄μ–ΈνΈλ“¤λ§ μ ‘κ·Όν•  μ μλ„λ΅ ν•λ‹¤.
- **κ¶ν•**: ν•„μ”ν• κΈ°λ¥λ§ μ‚¬μ©ν•  μ μλ„λ΅ μ ν•λ κ¶ν•μ„ λ¶€μ—¬ν•λ‹¤.

<br/>

### 9.1.1 μ•”νΈν™”(SSL)
- μ•”νΈν™” ν†µμ‹ μ„ μ„¤μ •ν•κΈ° μ„ν•΄ μΌλ°μ μΌλ΅ SSLμ„ μ‚¬μ©ν•λ‹¤.
- `SSL`: (λ³΄μ• μ†μΌ“ λ μ΄μ–΄) μ„λ²„μ™€ μ„λ²„/ν΄λΌμ΄μ–ΈνΈ μ‚¬μ΄μ—μ„ ν†µμ‹  λ³΄μ•μ„ μ μ©ν•κΈ° μ„ν• ν‘μ¤€ μ•”νΈ κ·μ•½
- λ™μ‘ λ°©μ‹μ€ λ‹¤μκ³Ό κ°™λ‹¤.
  - SSLμ€ μΈμ¦κΈ°κ΄€(CA)μΌλ΅λ¶€ν„° μΈμ¦μ„λ¥Ό λ°κΈ‰λ°›μ€ ν›„, μΈμ •μ„λ¥Ό μ΄μ©ν• κ³µκ°ν‚¤, κ°μΈ ν‚¤ λ°©μ‹μΌλ΅ μ„λ²„μ™€ ν΄λΌμ΄μ–ΈνΈκ°€ μ•”νΈν™”/λ³µνΈν™”ν•λ©΄μ„ ν†µμ‹ ν•λ‹¤.
  - μ•”νΈν™”/λ³µνΈν™”λ¥Ό μ„ν•΄ λ―Έλ¦¬ μ§€μ •λ ν‚¤λ¥Ό μ£Όκ³ λ°›μ•„μ•Ό ν•λ”λ°, μ΄λ• μ‚¬μ©ν•λ” ν‚¤μ λ°©μ‹μΌλ΅ λ€μΉ­ ν‚¤ λ°©μ‹κ³Ό λΉ„λ€μΉ­ ν‚¤ λ°©μ‹μ΄ μλ‹¤.
    - **λ€μΉ­ ν‚¤ λ°©μ‹**: ν•λ‚μ ν‚¤λ¥Ό κ°€μ§€κ³  μ„λ²„μ™€ ν΄λΌμ΄μ–ΈνΈκ°€ ν†µμ‹ ν•λ‹¤. (μ¤λ²„ν—¤λ“λ” μ μ§€λ§ λ…Έμ¶ μ„ν—μ„±μ΄ μμ)
    - **λΉ„λ€μΉ­ ν‚¤ λ°©μ‹**: 2κ°μ ν‚¤λ¥Ό κ°€μ§€κ³  μ„λ²„μ™€ ν΄λΌμ΄μ–ΈνΈκ°€ ν†µμ‹ ν•λ‹¤. (λ…Έμ¶ μ„ν—μ„±μ€ μ μ§€λ§ μ¤λ²„ν—¤λ“κ°€ νΌ)
   
- SSLμ€ λ³΄μ•μ„ κ°•ν™”ν•λ©΄μ„ ν¨μ¨μ μΈ κ³ μ„±λ¥μ„ μ–»κΈ° μ„ν•΄ λ€μΉ­ ν‚¤μ™€ λΉ„λ€μΉ­ ν‚¤μ 2κ°€μ§€ λ°©μ‹μ„ νΌμ©ν•λ” λ°©μ‹μΌλ΅ μ‚¬μ©ν•λ‹¤.

<br/>

### 9.1.2 μΈμ¦(SASL)
- `SASL`: μΈν„°λ„· ν”„λ΅ν† μ½μ—μ„ μΈμ¦κ³Ό λ°μ΄ν„° λ³΄μ•μ„ μ„ν• ν”„λ μ„μ›ν¬λ΅μ„ μΉ΄ν”„μΉ΄μ—μ„λ„ μ‚¬μ©λλ‹¤.
- μ• ν”λ¦¬μΌ€μ΄μ… ν”„λ΅ν† μ½μ—μ„ **μΈμ¦ λ©”μ»¤λ‹μ¦**μ„ λ¶„λ¦¬ν•¨μΌλ΅μ¨ λ¨λ“  μ• ν”λ¦¬μΌ€μ΄μ…μ—μ„ μ‚¬μ©ν•  μ μλ‹¤.
  - **SASL/GSSAPI**: (μΉ΄ν”„μΉ΄ 0.9ver ~) μ»¤λ²„λ΅μ¤ λ°©μ‹μΌλ΅ λ§μ΄ μ‚¬μ©λλ” μΈμ¦ λ°©μ‹ μ¤‘ ν•λ‚μ΄λ‹¤. (λλ„λ΅ ν•λ‚μ λ λ¦„μΌλ΅ λ¨λ“  μ• ν”λ¦¬μΌ€μ΄μ…μ„ μ μ©ν•λ” κ²ƒμ΄ μ¶”μ²λ¨)
  - **SASL/PLAIN**: (μΉ΄ν”„μΉ΄ 0.10.0ver ~) μ•„μ΄λ””μ™€ λΉ„λ°€λ²νΈλ¥Ό ν…μ¤νΈ ν•νƒλ΅ μ‚¬μ©ν•λ‹¤. (κ°λ° ν™κ²½μ—μ„ ν…μ¤νΈ λ©μ μΌλ΅ μ£Όλ΅ ν™μ©λ¨)
  - **SASL/SCRAM-SHA-256, SASL/SCRAM-SHA-512**: (μΉ΄ν”„μΉ΄ 0.10.2ver ~) λ³Έλμ μ•”νΈμ— ν•΄μ‹λ λ‚΄μ©μ„ μ¶”κ°€ν•¨μΌλ΅μ¨ μ•”νΈκ°€ μ μ¶λμ–΄λ„ λ³Έλ μ•”νΈλ¥Ό μ• μ μ—†μ–΄ μ•μ „ν•κ² μ €μ¥ν•  μ μλ‹¤.
  - **SASL/OAUTHBEARER**: (μΉ΄ν”„μΉ΄ 2.0ver ~) μΉ΄ν”„μΉ΄μ—μ„ μ κ³µν•λ” κΈ°λ¥μ€ λ§¤μ° ν•μ •μ μ΄λΌ κ°λ° ν™κ²½ μ •λ„μ—λ§ μ μ© κ°€λ¥ν• μμ¤€μ΄λ‹¤. (μ΄μ ν™κ²½μ—μ„ λ³„λ„μ ν•Έλ“¤λ¬ κµ¬μ„± ν•„μ”)
 
<br/>

### 9.1.3 κ¶ν•(ACL)
- `ACL`: (μ ‘κ·Ό μ μ–΄ λ¦¬μ¤νΈ) κ·μΉ™ κΈ°λ°μ λ¦¬μ¤νΈλ¥Ό λ§λ“¤μ–΄ μ ‘κ·Ό μ μ–΄λ¥Ό ν•λ” κ²ƒ
- CLIλ΅ ACLμ„ μ¶”κ°€ν•κ±°λ‚ μ‚­μ ν•  μ μμΌλ©° λ¨λ“  ACL κ·μΉ™μ€ μ£Όν‚¤νΌμ— μ €μ¥λλ‹¤.
- ACLμ€ **λ¦¬μ†μ¤ νƒ€μ…**λ³„λ΅ κµ¬μ²΄μ μΈ μ„¤μ •μ΄ κ°€λ¥ν•λ‹¤.
  - **ν† ν”½**, **κ·Έλ£Ή**, ν΄λ¬μ¤ν„°, νΈλμ­μ…”λ„ ID, μ„μ„ ν† ν°

<br/>

<img alt="image" width="500" src="https://github.com/mash-up-kr/S3A/assets/55437339/54803e9d-1c01-4c61-9f6b-918b8cf1fb00"/>

π”Ό κ¶ν• λ¶„λ¦¬κ°€ ν•„μ”ν• μ‚¬λ΅€
- B μ„λΉ„μ¤μ—μ„ κ°λ° λ‹΄λ‹Ήμμ μ‹¤μλ΅ μΈν•΄ A μ„λΉ„μ¤κ°€ μ‚¬μ©ν•λ” A ν† ν”½μΌλ΅ B μ„λΉ„μ¤μ λ©”μ‹μ§€λ“¤μ„ μ „μ†΅ν–λ‹¤.
- A μ„λΉ„μ¤ μ»¨μλ¨Έκ°€ A ν† ν”½μ λ‚΄μ©μ„ μ½λ‹¤κ°€ B μ„λΉ„μ¤μ λ©”μ‹μ§€λ΅ μΈν•΄ νμ‹± μ—λ¬κ°€ λ°μƒν•λ©΄μ„ μ—¬λ¬ κ°€μ§€ λ¬Έμ κ°€ λ°μƒν•  μ μλ‹¤.

<br/>

## 9.2 SSLμ„ μ΄μ©ν• μΉ΄ν”„μΉ΄ μ•”νΈν™”

<img alt="image" width="500" src="https://github.com/mash-up-kr/S3A/assets/55437339/6a6f9de9-b14e-4ab1-b69f-693c3186e356"/>

π”Ό μΉ΄ν”„μΉ΄ SSL μ μ© κ°μ” (ν΄λ¬μ¤ν„° ν™κ²½ κΈ°μ¤€)

<br/>

### 9.2.1 λΈλ΅μ»¤ ν‚¤μ¤ν† μ–΄ μƒμ„±

<img alt="image" width="500" src="https://github.com/mash-up-kr/S3A/assets/55437339/5fc8d6e2-1645-407f-804b-0a152e502bbe"/>

π”Ό ν‚¤μ¤ν† μ–΄μ™€ νΈλ¬μ¤νΈμ¤ν† μ–΄μ κ΄€κ³„λ„
- ν΄λΌμ΄μ–ΈνΈμ™€ μ„λ²„ μ‚¬μ΄μ— μλ°” μ• ν”λ¦¬μΌ€μ΄μ…μ„ μ΄μ©ν•΄ SSL μ—°κ²°μ„ ν•  λ• μ‚¬μ©ν•λ‹¤.
- ν‚¤μ¤ν† μ–΄μ™€ νΈλ¬μ¤νΈμ¤ν† μ–΄ λ¨λ‘ keytoolμ„ μ΄μ©ν•΄ κ΄€λ¦¬λλ©°, κ° μ¤ν† μ–΄μ— μ €μ¥λλ” λ‚΄μ©μ€ μ°¨μ΄κ°€ μλ‹¤.
  - **ν‚¤μ¤ν† μ–΄**: μ„λ²„ μΈ΅λ©΄μ—μ„ ν”„λΌμ΄λΉ— ν‚¤μ™€ μΈμ¦μ„λ¥Ό μ €μ¥ν•λ©°, μκ²© μ¦λ…μ„ μ κ³µν•λ‹¤.
  - **νΈλ¬μ¤νΈμ¤ν† μ–΄**: ν΄λΌμ΄μ–ΈνΈ μΈ΅λ©΄μ—μ„ μ„λ²„κ°€ μ κ³µν•λ” μΈμ¦μ„λ¥Ό κ²€μ¦ν•κΈ° μ„ν• νΌλΈ”λ¦­ ν‚¤μ™€ SSL μ—°κ²°μ—μ„ μ ν¨μ„±μ„ κ²€μ‚¬ν•λ” μ„λ…λ μΈμ¦μ„λ¥Ό μ €μ¥ν•λ‹¤. (λ―Όκ°ν• μ •λ³΄X)
 
<br/>

> **μ‹¤μµ**

```bash
$ sudo mkdir -p /usr/local/kafka/ssl # ssl λ””λ ‰ν† λ¦¬ μƒμ„± (ν•„μ”ν• νμΌλ“¤μ„ λ¨μ•„λ‘κΈ° μ„ν•¨)
$ cd /usr/local/kafka/ssl/ # λ””λ ‰ν† λ¦¬ μ§„μ…
$ export SSLPASS=peterpass # λΉ„λ°€λ²νΈ ν†µμΌ (for ν…μ¤νΈ ν™κ²½)
```
π”Ό λ””λ ‰ν† λ¦¬ μƒμ„±

<br/>

```bash
sudo keytool -keystore kafka.server.keystore.jks -alias localhost -keyalg RSA -validity 365 -genkey -storepass $SSLPASS -keypass $SSLPASS -dname "CN=peter-kafka01.foo.bar" -storetype pkcs12
```
π”Ό ν‚¤μ¤ν† μ–΄ μƒμ„±

<br/>

|μµμ… μ΄λ¦„|μ„¤λ…|
|---|---|
|keystore|ν‚¤μ¤ν† μ–΄ μ΄λ¦„|
|alias|λ³„μΉ­|
|keyalg|ν‚¤ μ•κ³ λ¦¬μ¦|
|genkey|ν‚¤ μƒμ„±|
|validity|μ ν¨ μΌμ|
|storepass|μ €μ¥μ† λΉ„λ°€λ²νΈ|
|keypass|ν‚¤ λΉ„λ°€λ²νΈ|
|dname|μ‹λ³„ μ΄λ¦„|
|storetype|μ €μ¥ νƒ€μ…|

π”Ό keytoolμ μƒμ„Έ μµμ…

<br/>

```bash
$ keytool -list -v keystore kafka.server.keystore.jks
ν‚¤ μ €μ¥μ† λΉ„λ°€λ²νΈ μ…λ ¥: peterpass
```
π”Ό ν‚¤μ¤ν† μ–΄μ λ‚΄μ© ν™•μΈ
- μ¶λ ¥ λ‚΄μ©μ„ ν†µν•΄ μµμ…μΌλ΅ μ„¤μ •ν• μ €μ¥μ† μ ν•, μ ν¨ κΈ°κ°„, μ•κ³ λ¦¬μ¦, μ†μ μ, λ°ν–‰μ λ“±μ—μ„ μ„¤μ •ν• λ‚΄μ©λ“¤μ„ ν™•μΈν•  μ μλ‹¤.

<br/>

### 3.2.2 CA μΈμ¦μ„ μƒμ„±
